# language: zh-TW
功能: 狀態模式執行測試

  背景:
    假設 系統已初始化測試資料
    而且 稽核追蹤機制已啟用
    而且 測試客戶資料已準備

  場景: 活躍優惠狀態評估
    假設 系統建立了一個 "ACTIVE" 狀態的優惠
    而且 優惠有效期限設定為 30 天後
    當 客戶請求優惠評估
    那麼 優惠評估結果應該符合條件
    而且 評估結果描述應該包含 "優惠處於活躍狀態"
    而且 優惠應該標示為活躍
    而且 優惠應該標示為非終止狀態

  場景: 活躍優惠自動過期
    假設 系統建立了一個 "ACTIVE" 狀態的優惠
    而且 優惠有效期限設定為 1 天前
    當 客戶請求優惠評估
    那麼 優惠評估結果應該不符合條件
    而且 評估結果描述應該包含 "優惠已過期"
    而且 優惠當前狀態應該是 "EXPIRED"

  場景: 活躍優惠轉換為暫停狀態
    假設 系統建立了一個 "ACTIVE" 狀態的優惠
    當 嘗試暫停優惠，原因為 "系統維護"
    那麼 狀態轉換應該成功
    而且 優惠當前狀態應該是 "SUSPENDED"
    而且 優惠應該標示為非活躍
    而且 優惠上下文應該記錄暫停原因
    而且 優惠上下文應該記錄暫停時間
    而且 狀態變更歷史應該包含 "暫停" 事件

  場景: 活躍優惠轉換為過期狀態
    假設 系統建立了一個 "ACTIVE" 狀態的優惠
    當 嘗試使優惠過期
    那麼 狀態轉換應該成功
    而且 優惠當前狀態應該是 "EXPIRED"
    而且 優惠應該標示為非活躍
    而且 優惠應該標示為終止狀態
    而且 優惠上下文應該記錄過期時間
    而且 狀態變更歷史應該包含 "過期" 事件

  場景: 活躍優惠重複啟用失敗
    假設 系統建立了一個 "ACTIVE" 狀態的優惠
    當 嘗試啟用優惠
    那麼 狀態轉換應該失敗
    而且 轉換失敗訊息應該包含 "已經處於活躍狀態"

  場景: 暫停優惠評估
    假設 系統建立了一個 "SUSPENDED" 狀態的優惠
    當 客戶請求優惠評估
    那麼 優惠評估結果應該不符合條件
    而且 評估結果描述應該包含 "優惠已暫停"
    而且 優惠應該標示為非活躍
    而且 優惠應該標示為非終止狀態

  場景: 暫停優惠重新啟用
    假設 系統建立了一個 "SUSPENDED" 狀態的優惠
    而且 優惠有效期限設定為 30 天後
    當 嘗試啟用優惠
    那麼 狀態轉換應該成功
    而且 優惠當前狀態應該是 "ACTIVE"
    而且 優惠應該標示為活躍
    而且 狀態變更歷史應該包含 "恢復" 事件

  場景: 暫停優惠啟用時發現已過期
    假設 系統建立了一個 "SUSPENDED" 狀態的優惠
    而且 優惠有效期限設定為 1 天前
    當 嘗試啟用優惠
    那麼 狀態轉換應該失敗
    而且 轉換失敗訊息應該包含 "優惠已過期"
    而且 優惠當前狀態應該是 "EXPIRED"

  場景: 暫停優惠更新暫停原因
    假設 系統建立了一個 "SUSPENDED" 狀態的優惠
    當 嘗試暫停優惠，原因為 "新的暫停原因"
    那麼 狀態轉換應該成功
    而且 狀態變更歷史應該包含 "更新暫停原因" 事件

  場景: 暫停優惠轉換為過期狀態
    假設 系統建立了一個 "SUSPENDED" 狀態的優惠
    當 嘗試使優惠過期
    那麼 狀態轉換應該成功
    而且 優惠當前狀態應該是 "EXPIRED"
    而且 優惠應該標示為終止狀態

  場景: 過期優惠評估
    假設 系統建立了一個 "EXPIRED" 狀態的優惠
    當 客戶請求優惠評估
    那麼 優惠評估結果應該不符合條件
    而且 評估結果描述應該包含 "優惠已於"
    而且 評估結果描述應該包含 "過期"
    而且 優惠應該標示為非活躍
    而且 優惠應該標示為終止狀態

  場景: 過期優惠無法啟用
    假設 系統建立了一個 "EXPIRED" 狀態的優惠
    當 嘗試啟用優惠
    那麼 狀態轉換應該失敗
    而且 轉換失敗訊息應該包含 "優惠已過期，無法重新啟用"

  場景: 過期優惠無法暫停
    假設 系統建立了一個 "EXPIRED" 狀態的優惠
    當 嘗試暫停優惠，原因為 "測試原因"
    那麼 狀態轉換應該失敗
    而且 轉換失敗訊息應該包含 "優惠已過期，無法執行暫停操作"

  場景: 過期優惠重複過期失敗
    假設 系統建立了一個 "EXPIRED" 狀態的優惠
    當 嘗試使優惠過期
    那麼 狀態轉換應該失敗
    而且 轉換失敗訊息應該包含 "優惠已經處於過期狀態"

  場景: 系統自動過期檢查 - 有效優惠
    假設 系統建立了一個 "ACTIVE" 狀態的優惠
    而且 優惠有效期限設定為 30 天後
    當 系統自動檢查優惠過期狀態
    那麼 優惠當前狀態應該是 "ACTIVE"

  場景: 系統自動過期檢查 - 過期優惠
    假設 系統建立了一個 "ACTIVE" 狀態的優惠
    而且 優惠有效期限設定為 1 天前
    當 系統自動檢查優惠過期狀態
    那麼 優惠當前狀態應該是 "EXPIRED"

  場景: 手動狀態轉換
    假設 系統建立了一個 "ACTIVE" 狀態的優惠
    當 手動轉換優惠狀態到 "SUSPENDED"，參數為 "手動暫停測試"
    那麼 狀態轉換應該成功
    而且 優惠當前狀態應該是 "SUSPENDED"

  場景: 優惠狀態統計資訊查詢
    假設 系統建立了一個 "ACTIVE" 狀態的優惠
    而且 優惠有效期限設定為 30 天後
    當 嘗試暫停優惠，原因為 "測試暫停"
    而且 嘗試啟用優惠
    而且 查詢優惠狀態統計資訊
    那麼 統計資訊應該包含當前狀態
    而且 統計資訊應該包含狀態變更次數
    而且 統計資訊應該包含創建時間和更新時間

  場景: 暫停優惠超過最大暫停期限自動過期
    假設 系統建立了一個 "SUSPENDED" 狀態的優惠
    而且 優惠有效期限設定為 30 天後
    而且 優惠最大暫停期限設定為 1 天
    當 系統自動檢查優惠過期狀態
    那麼 優惠當前狀態應該是 "EXPIRED"