# language: zh-TW
功能: 策略模式執行測試

  背景:
    假設 系統已初始化測試資料
    而且 稽核追蹤機制已啟用

  場景: 百分比折扣策略計算
    假設 系統配置了 "PERCENTAGE_DISCOUNT" 計算策略
    而且 客戶年收入為 1000000 元
    而且 客戶帳戶類型為 "VIP"
    而且 策略參數設定折扣百分比為 10.0%
    而且 策略參數設定基準金額為 500000 元
    而且 策略參數設定優惠名稱為 "VIP百分比折扣"
    當 執行策略計算
    而且 建立優惠結果
    那麼 計算結果應該為 50000.0 元
    而且 優惠結果應該包含正確的策略類型
    而且 優惠結果應該標示為符合條件
    而且 優惠結果應該包含折扣百分比 10.0%
    而且 優惠結果描述應該包含 "10.0%"
    而且 優惠結果的附加詳情應該包含策略類型
    而且 優惠結果應該包含客戶ID
    而且 優惠結果應該有有效期限

  場景: 百分比折扣策略使用客戶年收入作為預設基準金額
    假設 系統配置了 "PERCENTAGE_DISCOUNT" 計算策略
    而且 客戶年收入為 2000000 元
    而且 策略參數設定折扣百分比為 5.0%
    而且 策略參數設定優惠名稱為 "年收入百分比折扣"
    當 執行策略計算
    而且 建立優惠結果
    那麼 計算結果應該為 100000.0 元
    而且 優惠結果應該標示為符合條件
    而且 優惠結果應該包含折扣百分比 5.0%

  場景: 階層式折扣策略 - 高階層客戶
    假設 系統配置了 "TIERED_DISCOUNT" 計算策略
    而且 客戶年收入為 2500000 元
    而且 客戶帳戶類型為 "VIP"
    而且 策略參數設定階層式折扣規則
    而且 策略參數設定優惠名稱為 "VIP階層式折扣"
    當 執行策略計算
    而且 建立優惠結果
    那麼 計算結果應該為 375000.0 元
    而且 優惠結果應該包含折扣百分比 15.0%
    而且 優惠結果描述應該包含 "階層式折扣優惠"
    而且 優惠結果描述應該包含 "15.0%"

  場景: 階層式折扣策略 - 中階層客戶
    假設 系統配置了 "TIERED_DISCOUNT" 計算策略
    而且 客戶年收入為 1500000 元
    而且 策略參數設定階層式折扣規則
    當 執行策略計算
    而且 建立優惠結果
    那麼 計算結果應該為 150000.0 元
    而且 優惠結果應該包含折扣百分比 10.0%

  場景: 階層式折扣策略 - 低階層客戶
    假設 系統配置了 "TIERED_DISCOUNT" 計算策略
    而且 客戶年收入為 800000 元
    而且 策略參數設定階層式折扣規則
    當 執行策略計算
    而且 建立優惠結果
    那麼 計算結果應該為 40000.0 元
    而且 優惠結果應該包含折扣百分比 5.0%

  場景: 階層式折扣策略 - 不符合任何階層
    假設 系統配置了 "TIERED_DISCOUNT" 計算策略
    而且 客戶年收入為 300000 元
    而且 策略參數設定階層式折扣規則
    當 執行策略計算
    而且 建立優惠結果
    那麼 計算結果應該為 0.0 元

  場景: 固定金額策略 - 符合最低購買要求
    假設 系統配置了 "FIXED_AMOUNT" 計算策略
    而且 客戶年收入為 800000 元
    而且 策略參數設定固定優惠金額為 5000 元
    而且 策略參數設定最低購買金額為 50000 元
    而且 策略參數設定優惠名稱為 "新戶開戶優惠"
    當 執行策略計算
    而且 建立優惠結果
    那麼 計算結果應該為 5000.0 元
    而且 優惠結果應該標示為符合條件
    而且 優惠結果的折扣百分比應該為空
    而且 優惠結果描述應該包含 "固定金額優惠 5000 元"

  場景: 固定金額策略 - 不符合最低購買要求
    假設 系統配置了 "FIXED_AMOUNT" 計算策略
    而且 客戶年收入為 300000 元
    而且 策略參數設定固定優惠金額為 5000 元
    而且 策略參數設定最低購買金額為 100000 元
    當 執行策略計算
    而且 建立優惠結果
    那麼 計算結果應該為 0.0 元
    而且 優惠結果應該標示為不符合條件
    而且 優惠結果描述應該包含 "不符合最低購買金額要求"

  場景: 策略參數驗證 - 有效參數
    假設 系統配置了 "PERCENTAGE_DISCOUNT" 計算策略
    而且 策略參數設定折扣百分比為 15.0%
    而且 策略參數設定基準金額為 100000 元
    當 驗證策略參數
    那麼 參數驗證應該通過

  場景: 策略參數驗證 - 無效參數
    假設 系統配置了 "PERCENTAGE_DISCOUNT" 計算策略
    當 使用無效的策略參數
    而且 驗證策略參數
    那麼 參數驗證應該失敗

  場景: 策略計算異常處理
    假設 系統配置了 "PERCENTAGE_DISCOUNT" 計算策略
    而且 客戶年收入為 1000000 元
    當 使用無效的策略參數
    而且 執行策略計算
    那麼 應該拋出參數驗證異常