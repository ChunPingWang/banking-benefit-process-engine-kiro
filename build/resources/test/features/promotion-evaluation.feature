# language: zh-TW
功能: 銀行客戶優惠評估
  作為銀行業務人員
  我希望能透過API提交客戶資料
  以便系統自動推薦適合的優惠方案並記錄完整的稽核軌跡

  背景:
    假設 系統已初始化測試資料
    而且 稽核追蹤機制已啟用
    而且 外部系統模擬服務已準備就緒

  場景: 高價值客戶獲得VIP優惠 (包含每步驟稽核記錄)
    假設 客戶 "CUST001" 的年收入為 2000000 元
    而且 客戶帳戶類型為 "VIP"
    而且 客戶信用評等為 "AAA"
    而且 客戶月平均交易金額為 500000 元
    當 系統接收到優惠評估請求
    而且 系統開始記錄稽核軌跡
    而且 系統執行決策樹 "VIP_PROMOTION"
    而且 系統評估收入條件節點 "INCOME_CHECK"
    而且 系統評估帳戶類型條件節點 "ACCOUNT_TYPE_CHECK"
    而且 系統呼叫外部信用評等系統
    而且 系統執行VIP優惠計算節點 "VIP_CALCULATION"
    那麼 應該返回 "VIP專屬理財優惠" 結果
    而且 優惠金額應該大於 10000 元
    而且 系統應該記錄完整的決策軌跡
    而且 稽核記錄應該包含 5 個決策步驟
    而且 稽核記錄應該包含外部系統呼叫記錄
    而且 每個決策步驟都應該有執行時間記錄
    而且 請求處理總時間應該少於 3000 毫秒

  場景: 一般客戶獲得基礎優惠 (包含決策路徑追蹤)
    假設 客戶 "CUST002" 的年收入為 800000 元
    而且 客戶帳戶類型為 "一般"
    而且 客戶信用評等為 "AA"
    而且 客戶月平均交易金額為 50000 元
    當 系統接收到優惠評估請求
    而且 系統開始記錄稽核軌跡
    而且 系統執行決策樹 "REGULAR_PROMOTION"
    而且 系統評估收入條件節點 "INCOME_CHECK"
    而且 系統評估帳戶類型條件節點 "ACCOUNT_TYPE_CHECK"
    而且 系統呼叫外部交易歷史系統
    而且 系統執行一般優惠計算節點 "REGULAR_CALCULATION"
    那麼 應該返回 "一般客戶優惠方案" 結果
    而且 優惠金額應該在 1000 到 5000 元之間
    而且 系統應該記錄請求和回應資料
    而且 決策路徑應該包含 4 個節點
    而且 所有節點執行狀態都應該是 "SUCCESS"
    而且 稽核軌跡應該可以重現決策過程

  場景: 不符合條件客戶的反向場景 (包含拒絕原因記錄)
    假設 客戶 "CUST004" 的年收入為 300000 元
    而且 客戶帳戶類型為 "一般"
    而且 客戶信用評等為 "C"
    而且 客戶月平均交易金額為 5000 元
    當 系統接收到優惠評估請求
    而且 系統開始記錄稽核軌跡
    而且 系統執行決策樹 "REGULAR_PROMOTION"
    而且 系統評估收入條件節點 "INCOME_CHECK"
    而且 系統評估信用評等條件節點 "CREDIT_CHECK"
    而且 系統執行風險評估檢查
    那麼 應該返回 "不符合優惠條件" 結果
    而且 拒絕原因應該包含 "收入不足" 和 "信用評等過低"
    而且 系統應該記錄拒絕原因的詳細資訊
    而且 稽核記錄應該包含風險評估結果
    而且 決策路徑應該在信用檢查節點終止
    而且 系統事件應該記錄拒絕決策的原因

  場景: 新客戶獲得開戶優惠
    假設 客戶 "CUST003" 是新客戶
    而且 客戶年收入為 500000 元
    而且 客戶帳戶類型為 "新客戶"
    當 系統接收到優惠評估請求
    而且 系統開始記錄稽核軌跡
    而且 系統執行決策樹 "NEW_CUSTOMER_PROMOTION"
    而且 系統評估新客戶條件節點 "NEW_CUSTOMER_CHECK"
    而且 系統執行新戶優惠計算節點 "NEW_CUSTOMER_CALCULATION"
    那麼 應該返回 "新戶開戶優惠" 結果
    而且 優惠內容應該包含 "免手續費" 和 "利率優惠"
    而且 系統應該記錄新客戶標識
    而且 稽核軌跡應該標記為新客戶流程

  場景: 系統異常處理和錯誤追蹤
    假設 外部信用評等系統暫時不可用
    而且 客戶 "CUST001" 提交優惠評估請求
    當 系統嘗試呼叫外部信用評等系統
    而且 外部系統返回錯誤
    而且 系統啟用降級策略
    那麼 系統應該使用預設信用評等
    而且 系統應該記錄外部系統錯誤事件
    而且 稽核軌跡應該包含降級策略執行記錄
    而且 系統事件應該標記為 "EXTERNAL_SYSTEM_ERROR"
    而且 最終仍應該返回有效的優惠結果