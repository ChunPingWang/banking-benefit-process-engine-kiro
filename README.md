# éŠ€è¡Œå®¢æˆ¶å„ªæƒ ç³»çµ± (Bank Customer Promotion System)

åŸºæ–¼Spring Boot 3çš„éŠ€è¡Œå®¢æˆ¶å„ªæƒ æ¨è–¦ç³»çµ±ï¼Œæ¡ç”¨å…­è§’å½¢æ¶æ§‹å’Œé ˜åŸŸé©…å‹•è¨­è¨ˆã€‚

## å°ˆæ¡ˆçµæ§‹

```
src/
â”œâ”€â”€ main/
â”‚   â”œâ”€â”€ java/com/bank/promotion/
â”‚   â”‚   â”œâ”€â”€ PromotionSystemApplication.java     # ä¸»æ‡‰ç”¨ç¨‹å¼
â”‚   â”‚   â”œâ”€â”€ domain/                             # é ˜åŸŸå±¤
â”‚   â”‚   â”‚   â”œâ”€â”€ aggregate/                     # èšåˆæ ¹
â”‚   â”‚   â”‚   â”œâ”€â”€ entity/                        # å¯¦é«”
â”‚   â”‚   â”‚   â”œâ”€â”€ valueobject/                   # å€¼ç‰©ä»¶
â”‚   â”‚   â”‚   â””â”€â”€ exception/                     # é ˜åŸŸç•°å¸¸
â”‚   â”‚   â”œâ”€â”€ application/                        # æ‡‰ç”¨å±¤
â”‚   â”‚   â”‚   â”œâ”€â”€ command/                       # å‘½ä»¤è™•ç†å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ query/                         # æŸ¥è©¢è™•ç†å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ service/                       # æ‡‰ç”¨æœå‹™
â”‚   â”‚   â”‚   â””â”€â”€ controller/                    # REST API æ§åˆ¶å™¨
â”‚   â”‚   â””â”€â”€ adapter/                           # é©é…å™¨å±¤
â”‚   â”‚       â”œâ”€â”€ config/                        # é…ç½®é¡åˆ¥
â”‚   â”‚       â”œâ”€â”€ repository/                    # è³‡æ–™åº«é©é…å™¨
â”‚   â”‚       â”œâ”€â”€ external/                      # å¤–éƒ¨ç³»çµ±é©é…å™¨
â”‚   â”‚       â””â”€â”€ audit/                         # ç¨½æ ¸é©é…å™¨
â”‚   â””â”€â”€ resources/
â”‚       â”œâ”€â”€ application*.yml                    # å¤šç’°å¢ƒé…ç½®
â”‚       â”œâ”€â”€ schema.sql                          # è³‡æ–™åº«çµæ§‹
â”‚       â”œâ”€â”€ data.sql                           # åˆå§‹è³‡æ–™
â”‚       â””â”€â”€ rules/                             # Droolsè¦å‰‡æª”æ¡ˆ
â””â”€â”€ test/
    â”œâ”€â”€ java/                                  # æ¸¬è©¦ç¨‹å¼ç¢¼
    â”‚   â”œâ”€â”€ unit/                              # å–®å…ƒæ¸¬è©¦
â”‚   â”‚   â”œâ”€â”€ integration/                       # æ•´åˆæ¸¬è©¦
â”‚   â”‚   â””â”€â”€ bdd/                               # BDDæ¸¬è©¦
â”‚   â””â”€â”€ resources/                             # æ¸¬è©¦è³‡æº
â”‚       â””â”€â”€ features/                          # Gherkinè¦æ ¼æª”æ¡ˆ
```

## æŠ€è¡“æ£§

- **Java 17**
- **Spring Boot 3.2.0**
- **Spring Data JPA**
- **H2 Database** (é–‹ç™¼ç’°å¢ƒ)
- **PostgreSQL** (ç”Ÿç”¢ç’°å¢ƒ)
- **Drools Rules Engine 8.44.0**
- **Gradle 8.5**
- **JUnit 5 & Mockito** (æ¸¬è©¦)
- **Cucumber** (BDDæ¸¬è©¦)

## ç’°å¢ƒé…ç½®

### é–‹ç™¼ç’°å¢ƒ (dev)
- ä½¿ç”¨ H2 è¨˜æ†¶é«”è³‡æ–™åº«
- å•Ÿç”¨ H2 æ§åˆ¶å°: http://localhost:8080/h2-console
- è©³ç´°æ—¥èªŒè¼¸å‡º

### SIT/UAT/ç”Ÿç”¢ç’°å¢ƒ
- ä½¿ç”¨ PostgreSQL è³‡æ–™åº«
- é€£ç·šæ± é…ç½®
- å¿«å–é…ç½® (Caffeine)
- çµæ§‹åŒ–æ—¥èªŒ

## å¿«é€Ÿé–‹å§‹

### 1. å»ºç½®å°ˆæ¡ˆ
```bash
./gradlew build
```

### 2. åŸ·è¡Œæ¸¬è©¦
```bash
./gradlew test
```

### 3. å•Ÿå‹•æ‡‰ç”¨ç¨‹å¼ (é–‹ç™¼ç’°å¢ƒ)
```bash
./gradlew bootRun
```

### 4. åˆ‡æ›ç’°å¢ƒ
```bash
# SITç’°å¢ƒ
./gradlew bootRun --args='--spring.profiles.active=sit'

# UATç’°å¢ƒ
./gradlew bootRun --args='--spring.profiles.active=uat'

# ç”Ÿç”¢ç’°å¢ƒ
./gradlew bootRun --args='--spring.profiles.active=prod'
```

## è³‡æ–™åº«é…ç½®

### H2 (é–‹ç™¼ç’°å¢ƒ)
- URL: `jdbc:h2:mem:testdb`
- æ§åˆ¶å°: http://localhost:8080/h2-console
- ä½¿ç”¨è€…åç¨±: `sa`
- å¯†ç¢¼: (ç©ºç™½)

### PostgreSQL (å…¶ä»–ç’°å¢ƒ)
ç’°å¢ƒè®Šæ•¸é…ç½®:
- `DB_HOST`: è³‡æ–™åº«ä¸»æ©Ÿ
- `DB_PORT`: è³‡æ–™åº«åŸ è™Ÿ
- `DB_NAME`: è³‡æ–™åº«åç¨±
- `DB_USERNAME`: ä½¿ç”¨è€…åç¨±
- `DB_PASSWORD`: å¯†ç¢¼

## å¥åº·æª¢æŸ¥

æ‡‰ç”¨ç¨‹å¼å•Ÿå‹•å¾Œå¯é€éä»¥ä¸‹ç«¯é»æª¢æŸ¥ç‹€æ…‹:
- å¥åº·æª¢æŸ¥: http://localhost:8080/actuator/health
- æ‡‰ç”¨è³‡è¨Š: http://localhost:8080/actuator/info
- æ•ˆèƒ½æŒ‡æ¨™: http://localhost:8080/actuator/metrics

## æ¶æ§‹è¨­è¨ˆ

### å…­è§’å½¢æ¶æ§‹ (Hexagonal Architecture)

æœ¬å°ˆæ¡ˆæ¡ç”¨å…­è§’å½¢æ¶æ§‹ï¼Œåˆ†ç‚ºä¸‰å€‹ä¸»è¦å±¤æ¬¡ï¼š

#### ğŸ›ï¸ **æ‡‰ç”¨å±¤ (Application Layer)**
- **REST API Controllers**: è™•ç† HTTP è«‹æ±‚å’Œå›æ‡‰
- **Command Handlers**: è™•ç†å¯«å…¥æ“ä½œçš„å‘½ä»¤
- **Query Handlers**: è™•ç†è®€å–æ“ä½œçš„æŸ¥è©¢
- **Application Services**: å”èª¿æ¥­å‹™æµç¨‹å’Œäº‹å‹™ç®¡ç†

#### ğŸ¯ **é ˜åŸŸå±¤ (Domain Layer)**
- **Aggregates**: èšåˆæ ¹ï¼Œç®¡ç†æ¥­å‹™ä¸€è‡´æ€§
- **Entities**: å¯¦é«”ï¼Œå…·æœ‰å”¯ä¸€è­˜åˆ¥çš„æ¥­å‹™ç‰©ä»¶
- **Value Objects**: å€¼ç‰©ä»¶ï¼Œä¸å¯è®Šçš„æ¥­å‹™æ¦‚å¿µ
- **Domain Services**: é ˜åŸŸæœå‹™ï¼Œè·¨å¯¦é«”çš„æ¥­å‹™é‚è¼¯
- **Repository Interfaces**: è³‡æ–™å­˜å–çš„æŠ½è±¡ä»‹é¢

#### ğŸ”Œ **é©é…å™¨å±¤ (Adapter Layer)**
- **Repository Adapters**: è³‡æ–™åº«å­˜å–çš„å…·é«”å¯¦ä½œ
- **External System Adapters**: å¤–éƒ¨ç³»çµ±æ•´åˆé©é…å™¨
- **Cache Adapters**: å¿«å–ç³»çµ±é©é…å™¨
- **Audit Adapters**: ç¨½æ ¸ç³»çµ±é©é…å™¨

### é–‹ç™¼åŸå‰‡

æœ¬å°ˆæ¡ˆéµå¾ª:
- **å…­è§’å½¢æ¶æ§‹** (Hexagonal Architecture)
- **é ˜åŸŸé©…å‹•è¨­è¨ˆ** (Domain Driven Design)
- **CQRSæ¨¡å¼** (Command Query Responsibility Segregation)
- **æ¸¬è©¦å…ˆè¡Œé–‹ç™¼** (Test-First Development)
- **BDDè¡Œç‚ºé©…å‹•é–‹ç™¼** (Behavior Driven Development)

## é–‹ç™¼æµç¨‹

### ğŸ§ª **æ¸¬è©¦å…ˆè¡Œé–‹ç™¼**

æœ¬å°ˆæ¡ˆæ¡ç”¨æ¸¬è©¦å…ˆè¡Œçš„é–‹ç™¼æ–¹å¼ï¼š

1. **ç¬¬ä¸€éšæ®µ**: æ’°å¯« BDD æ¸¬è©¦å ´æ™¯å’Œ Gherkin è¦æ ¼
2. **Review éšæ®µ**: æ‰€æœ‰æ¸¬è©¦è¦æ ¼å¿…é ˆç¶“é review å’Œç¢ºèª  
3. **å¯¦ä½œéšæ®µ**: åŸºæ–¼å·²ç¢ºèªçš„æ¸¬è©¦è¦æ ¼é€²è¡Œç³»çµ±é–‹ç™¼

### ğŸ“‹ **å¯¦ä½œé †åº**

1. âœ… **å°ˆæ¡ˆçµæ§‹å’Œæ ¸å¿ƒé…ç½®** - å·²å®Œæˆ
2. âœ… **é ˜åŸŸæ¨¡å‹å’Œèšåˆæ ¹** - å·²å®Œæˆ
3. ğŸ”„ **BDD æ¸¬è©¦å ´æ™¯å’Œ Gherkin è¦æ ¼** - é€²è¡Œä¸­
4. **Command Pattern å’Œç¯€é»å‘½ä»¤**
5. **ç­–ç•¥æ¨¡å¼å’Œç‹€æ…‹æ¨¡å¼**
6. **CQRS æ¨¡å¼å’Œæ‡‰ç”¨å±¤**
7. **è³‡æ–™å­˜å–å±¤å’Œé©é…å™¨å±¤**
8. **REST API å’Œæ§åˆ¶å™¨å±¤**

### ğŸ” **ç¨½æ ¸åŠŸèƒ½**

ç³»çµ±å…§å»ºå®Œæ•´çš„ç¨½æ ¸è¿½è¹¤æ©Ÿåˆ¶ï¼š
- è¨˜éŒ„æ¯æ¬¡å¤–éƒ¨è«‹æ±‚çš„å®Œæ•´è™•ç†è»Œè·¡
- è¿½è¹¤æ‰€æœ‰æ±ºç­–ç¯€é»çš„åŸ·è¡Œéç¨‹
- ä¿å­˜å¤–éƒ¨ç³»çµ±å‘¼å«å’Œè³‡æ–™åº«æŸ¥è©¢è¨˜éŒ„
- æä¾›åˆè¦æ€§å ±å‘Šå’Œç¨½æ ¸æŸ¥è©¢åŠŸèƒ½

è©³ç´°å¯¦ä½œè¨ˆåŠƒè«‹åƒè€ƒ `.kiro/specs/bank-customer-promotion-system/tasks.md`